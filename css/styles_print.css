/* 
   PogokLink Print Stylesheet
   Version: Skeleton Foundation (No Borders)
   Goal: Redraw Monthly Calendar as a clean structural table.
*/

@media print {
    /* 1. Base Setup & Resets */
    @page {
        size: B4 landscape;
        margin: 10mm !important;
    }

    html, body {
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        overflow: visible !important;
        background-color: white !important;
        font-size: 11pt !important;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }

    body {
        height: auto !important;
        min-height: 0 !important;
    }

    /* Structural Wrappers Reset - Force EVERY parent to be full width */
    #app, 
    #app > div.flex, 
    #main-content, 
    #view-container, 
    .flex-grow,
    .fc-view-harness,
    .fc-view-harness-active {
        display: block !important;
        height: auto !important;
        overflow: visible !important;
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        flex: none !important; /* Kill flex constraints */
    }

    /* Universal UI Reset: No lines, no shadows, no rounded corners */
    *, ::before, ::after {
        box-shadow: none !important;
        filter: none !important;
        border-radius: 0 !important;
        border: none !important;
        outline: none !important;
    }

    /* 2. Visibility Controls */
    .no-print,
    .fc-header-toolbar,
    .fc-footer-toolbar,
    .fc-button-group,
    #sidebar,
    header,
    footer,
    aside,
    #main-header,
    .print-controls,
    #dept-view-table tfoot {
        display: none !important;
    }

    /* Print Header Setup */
    .print-only-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: baseline !important;
        width: 100% !important;
        margin-bottom: 15px !important;
        padding: 10px 0 !important;
        border-bottom: 1px solid #000 !important; /* Base divider for header */
    }

    .print-header-left { font-size: 22pt !important; font-weight: bold !important; }
    .print-header-right { font-size: 14pt !important; }

    /* 3. Monthly Calendar (Skeleton Table Structure) */
    
    /* Root FC Container - Force full width and kill all flex/alignment constraints */
    .fc {
        display: block !important;
        width: 100% !important;
        min-width: 100% !important;
        max-width: none !important;
        height: auto !important;
        overflow: visible !important;
        background: transparent !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Force EVERYTHING inside to be background-free and line-free */
    .fc, .fc *, .fc-view-harness, .fc-view-harness-active, .fc-day-today {
        background-color: transparent !important;
        background-image: none !important;
        border: none !important;
        border-width: 0 !important;
        /* width: auto; Removed to prevent shrink-wrap */
    }

    /* Explicit Today Background Reset & Hide Label */
    .fc .fc-day-today {
        background-color: transparent !important;
        background: none !important;
    }
    .fc .fc-today-label {
        display: none !important;
    }

    /* Scroller & Harness Logic: Force absolute full width */
    .fc .fc-view-harness,
    .fc .fc-view-harness-active,
    .fc .fc-scroller-harness,
    .fc .fc-scroller-harness-liquid,
    .fc .fc-scroller,
    .fc .fc-scroller-canvas,
    .fc .fc-scroller-canvas-inner,
    .fc .fc-scroller-canvas-inner,
    .fc-view-harness,
    .fc-view-harness-active,
    .fc-scroller-harness,
    .fc-scroller-harness-liquid,
    .fc-scroller,
    .fc-scroller-canvas,
    .fc-scroller-canvas-inner {
        display: block !important;
        overflow: visible !important;
        height: auto !important;
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        position: relative !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        
        /* [FIX] Ensure sharp corners */
        border-radius: 0 !important;
    }

    /* Structural Table Reconstruction - Nuclear 100% Width */
    /* Increased specificity to override styles.css which has .fc .fc-scrollgrid */
    .fc .fc-scrollgrid,
    .fc-scrollgrid {
        display: table !important;
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        table-layout: fixed !important;
        border-collapse: collapse !important;
        border-spacing: 0 !important;
        margin: 0 !important;
        border: none !important; /* Explicitly remove outer boundary */
        
        /* [FIX] Ensure corners meet sharp and aren't clipped */
        border-radius: 0 !important;
        overflow: visible !important;
    }

    .fc-scrollgrid-section-header { display: table-header-group !important; }
    .fc-scrollgrid-section-body { display: table-row-group !important; }
    .fc-scrollgrid-section { display: table-row !important; }
    .fc-scrollgrid-section > td { display: table-cell !important; width: 100% !important; }

    /* Unwrap rows */
    .fc-scrollgrid tbody { display: contents !important; }
    
    /* Gutter & Spacer management - Eliminate any right-side padding reservations */
    .fc-col-header-gutter, 
    .fc-daygrid-day-gutter,
    .fc-resource-group-gutter,
    .fc-scrollgrid-section-footer,
    .fc-scroller-harness-liquid > div[style*="margin-right"],
    .fc-scroller-harness-liquid > div[style*="padding-right"] {
        display: none !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Ensure ALL nested tables strictly follow the 100% width fixed model */
    .fc-scrollgrid table,
    .fc-col-header,
    .fc-daygrid-body,
    .fc-daygrid-body table {
        width: 100% !important;
        min-width: 100% !important;
        table-layout: fixed !important;
        border-collapse: collapse !important;
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    /* Grid Cells (Header & Body) */
    .fc .fc-col-header-cell,
    .fc .fc-daygrid-day,
    .fc-col-header-cell,
    .fc-daygrid-day {
        display: table-cell !important;
        width: 1px !important; /* Forces mathematically equal distribution */
        vertical-align: top !important;
        padding: 0 !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        
        /* [FIX] Use BOTH LEFT and RIGHT borders (1px) */
        /* In border-collapse: collapse, these 1px borders will merge. */
        /* Having both ensures the browser always draws the boundary even if one side has a background color. */
        border-left: 1px solid #999 !important;
        border-right: 1px solid #999 !important;
        border-bottom: 1px solid #999 !important;
        border-top: none !important;
    }

    /* Force TOP border only on the header row if needed (usually handled by collapse + row rules) */
    /* Ensuring the very top row has a boundary */
    .fc-scrollgrid-section-header .fc-col-header-cell {
        border-top: 1px solid #999 !important;
    }

    /* Ensure text visibility */
    .fc-col-header-cell a,
    .fc-daygrid-day-number {
        color: #000 !important;
        text-decoration: none !important;
        font-weight: bold !important;
    }

    /* Day Internal Layout */
    .fc-daygrid-day-frame {
        min-height: 120px !important; /* Base structural height */
        height: auto !important;
        overflow: visible !important;
        padding: 0 !important; /* [FIX] Remove padding here to allow header background to fill width */
    }

    /* [NEW] Apply padding to content containers instead of the frame */
    .calendar-cell-header,
    .calendar-dept-block,
    .fc-daygrid-day-bottom {
        padding-left: 4px !important;
        padding-right: 4px !important;
    }

    .calendar-cell-header {
        position: relative !important; /* Required for triangle absolute positioning */
        padding-top: 4px !important;
        /* [FIX] Narrow the background by 2px to prevent it from overlapping/thinning borders */
        width: calc(100% - 2px) !important;
        margin: 0 auto !important;
        margin-bottom: 2px !important;
        z-index: 1 !important; /* [FIX] Move below grid borders */
    }

    /* [NEW] Restore Triangle indicator for days in the current month */
    .fc-daygrid-day:not(.fc-day-other):not(.is-other-month) .calendar-cell-header::before {
        content: "" !important;
        position: absolute !important;
        top: 0 !important;
        left: -1px !important; /* [FIX] Align with left border line */
        width: 0 !important;
        height: 0 !important;
        border-style: solid !important;
        border-width: 10px 10px 0 0 !important;
        border-color: #6b7280 transparent transparent transparent !important;
        display: block !important;
        z-index: 10 !important;
    }

    /* Red triangle for Sat/Sun/Holidays (only in current month) */
    .fc-day-sun:not(.fc-day-other):not(.is-other-month) .calendar-cell-header::before,
    .fc-day-sat:not(.fc-day-other):not(.is-other-month) .calendar-cell-header::before,
    .is-holiday:not(.fc-day-other):not(.is-other-month) .calendar-cell-header::before {
        border-top-color: #dc2626 !important;
    }

    /* Prevent breaking inside weeks */
    .fc-daygrid-body table tr {
        break-inside: avoid !important;
        page-break-inside: avoid !important;
    }

    /* Custom Elements Skeleton */
    .calendar-dashed-divider {
        display: block !important;
        height: 1px !important;
        margin: 4px 8px !important;
        border-top: 1px dashed #ccc !important; /* Subtle structural divider */
    }

    /* Week Buffer Control */
    #calendar:not(.show-prev-week) .fc-row-prev-buffer,
    #calendar:not(.show-next-week) .fc-row-next-buffer {
        display: none !important;
    }
    #calendar.show-prev-week .fc-row-prev-buffer,
    #calendar.show-next-week .fc-row-next-buffer {
        display: table-row !important;
    }

    /* 4. List View Support (Minimalist) */
    #list-view-printable {
        max-width: 100% !important;
        width: 100% !important;
        overflow: hidden !important;
    }
    .list-day-block { break-inside: avoid !important; margin-bottom: 20px !important; }
    .list-1week-print-cols {
        column-count: 2 !important;
        column-gap: 2rem !important;
        width: 100% !important;
    }

    /* 5. Dept View Support (Table-based) */
    #dept-view-table {
        table-layout: fixed !important;
        width: 100% !important;
        border-collapse: collapse !important;
    }
    #dept-view-table td, #dept-view-table th {
        font-size: 10pt !important;
        padding: 4px !important;
        vertical-align: top !important;
        border: 1px solid #ccc !important; /* Keep subtle lines for Dept View as requested previously */
    }
    #dept-view-table .col-date { width: 40px !important; text-align: center; }
}
